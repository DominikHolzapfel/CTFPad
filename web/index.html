<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CTFPad :: StratumAuhuur</title>
    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/jquery.fileupload.css">
    <script src="js/jquery.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/jquery.ui.widget.js"></script>
    <script src="js/jquery.iframe-transport.js"></script>
    <script src="js/jquery.fileupload.js"></script>
    <script src="js/jquery.timeago.js"></script>
    <script src="js/etherpad.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/ctfpad.js"></script>
    <style type="text/css">
      td.padded {
        padding-right: 8px;
      }
      input[type="radio"], input[type="checkbox"] {
        line-height: normal;
        margin: 0;
      }
      .progress {
        position: relative;
        text-align: center;
      }
      .progress span {
        position: absolute;
        left: 0;
        width: 100%;
      }
      .highlighted {
        background-color: #FF7733;
      }
      #content:empty {
        display: none;
      }
      .active-user {
        padding: 2px;
        margin-right: 1px;
        margin-bottom: 2px;
        border-radius: 2px;
        font-size: 0.7em;
      }
    </style>
    <script type="text/javascript">
      window.etherpad_port = "{{etherpad_port}}"
      window.user = {name: "{{name}}", color: "{{color}}"}
      {{#current}}window.current = {name: "{{current.name}}", id: {{current.id}}}{{/current}}
    </script>
  </head>
  <body>

		<div class="container-fluid">
			<div class="row" id="row-navbar" >
				<nav class="navbar navbar-inverse">
				  <div class="container-fluid">
				    <div class="navbar-header">
				      <a class="navbar-brand" href="#">SwissMadeSecurity Pad</a>
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
								<span class="sr-only">Toggle navigation</span>
								<span class="glyphicon glyphicon-bar"></span>
								<span class="glyphicon glyphicon-bar"></span>
								<span class="glyphicon glyphicon-bar"></span>
							</button>
						</div>
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav navbar-right">
				        <li>
				          <div class="btn-group">
				            <button type="button" class="btn btn-default navbar-btn" href="#usermodal" data-toggle="modal">
											<span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span> Userlist [<span id="usercount">0</span>]
				            </button>
				          </div>
				          &nbsp;&nbsp;
				        </li>
				        <li>
				          <div class="btn-group" role="group">              	
										{{#current}}
				            <button type="button" class="btn btn-default navbar-btn" href="#ctfmodifymodal" data-toggle="modal">
											<i class="glyphicon glyphicon-flag"></i>
				              {{current.name}}
				            </button>
										{{/current}}
				         	 	{{^current}}
				            <button type="button" class="btn btn-default navbar-btn">no CTF chosen</button>
				          	{{/current}}
										<button type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" >
											<span class="caret"></span>
										</button>
				            <ul class="dropdown-menu">
				              {{#ctfs}}
				                <li><a href="/scope/{{id}}">{{name}}</a></li>
				              {{/ctfs}}
				              <li role="separator" class="divider"></li>
				              <li><a href="#allctfsmodal" data-toggle="modal">All CTFs</a></li>
				              <li><a href="#ctfmodal" data-toggle="modal">Add a CTF</a></li>
				            </ul>
				          </div>
								&nbsp;&nbsp;
				        </li>
				        <li>
				          <div class="btn-group">
				            <button type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" href="#">
				              <span class="glyphicon glyphicon-user" aria-hidden="true"></span> {{name}}
				              <span class="caret"></span>
				            </button>
				            <ul class="dropdown-menu">
				              <li><a href="#passwordmodal" data-toggle="modal">Change Password</a></li>
				              <!--<li><a href="#apikeymodal" data-toggle="modal">API Key</a></li> -->
				              <!--<li role="separator" class="divider"></li> -->
				              <!--<li><a href="/doc/API.html">API Documentation</a></li> -->
				              <li role="separator" class="divider"></li>
				              <li><a href="/logout">Log out</a></li>
				            </ul>
				          </div>
				        </li>
				      </ul>
				    </div>
				  </div>
				</nav>
			</div>
      <div class="row">
        <div class="col-sm-3">
          {{#current}}
            <div class="well">
              <div class="highlightable">
                <a href="#ctf{{id}}" class="contentlink"><h4 style="display:inline">{{current.name}}</h4></a>
                <span class="pull-right">
                  <!-- <a href="#" data-toggle="popover" class="scoreboard-toggle"><i class="icon-th-list"></i></a>&nbsp; -->
                  <a href="#ctf{{id}}files" class="contentlink"><i class="glyphicon glyphicon-folder-{{#files.length}}open{{/files.length}}{{^files.length}}close{{/files.length}}"></i></a> <sup>{{files.length}}</sup>
                </span>
              </div>
              <div class="progress">
                <div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"  style="width:0%;" id="progress"></div>
                <span></span>
              </div>
              <div class="progress">
                <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"  style="width:0%;" id="scoreprogress"></div>
                <span></span>
              </div>
              <!--<div class="progress progress-striped">
                <div class="bar bar-danger" style="width:83%;"></div>
              </div>-->
            </div>
            <div id="ctfmodification" class="alert alert-info hide">
              This CTF has been modified. You may want to reload the page.
            </div>
            <div class="well">
              <table width="100%">
                <tr width="100%">
                  <td colspan="5" align="right" width="100%">
                    <button id="hidefinished" type="button" class="btn btn-default btn-xs" data-toggle="button">hide finished</button>
                  </td>
                </tr>
                {{#categories}}
                  <tr class="category" data-category="{{name}}">
                    <td colspan="4"><strong>{{name}} [<span class="done-count">0</span>/{{challenges.length}}]</strong></td>
                    <td><span class="glyphicon glyphicon-collapse-down hide-cat-btn" data-category="{{name}}"></span></td>
                  </tr>
                  {{#challenges}}
                  <tr class="{{#points}}challenge{{/points}} {{#done}}done{{/done}} highlightable" data-chalpoints="{{points}}" data-category="{{name}}" data-challengeid="{{id}}">
                      <td class="padded"><input type="checkbox" data-chalid="{{id}}"{{#done}} checked{{/done}} autocomplete="off"></td>
                      <td class="padded" width="100%"{{#done}} style="text-decoration:line-through"{{/done}}>
                        <a href="#challenge{{id}}" class="contentlink">[{{points}}] {{title}}</a>
                        <div id="activeUsers{{id}}">
                          {{#users}}
                            <span class="active-user" style="background-color: {{color}}" data-name="{{name}}">{{name}}</span>
                          {{/users}}
                        </div>
                      </td>
                      <td class="padded"><a href="#challenge{{id}}" class="contentlink"><i class="glyphicon glyphicon-edit"></i></a></td>
                      <td class="padded" nowrap>
                        <a href="#challenge{{id}}files" class="contentlink"><i class="glyphicon glyphicon-folder-{{#files.length}}open{{/files.length}}{{^files.length}}close{{/files.length}}"></i></a>
                        <sup>{{files.length}}</sup>
                      </td>
                      <td nowrap>
                        <a data-toggle="popover" data-placement="right" data-trigger="manual" class="assignments" data-title="{{title}}"><i class="glyphicon glyphicon-user"></i></a>
                        <sup class="assignment-count" data-chalid="{{id}}">0</sup>
                        <div style="display:none" class="popover-content">
                          <div align="center" style="margin-bottom:10px">
                            <button class="btn btn-mini btn-assign" data-chalid="{{id}}">assign</button>
                          </div>
                          <ul class="unstyled labels" data-chalid="{{id}}"></ul>
                        </div>
                      </td>
                    </tr>
                  {{/challenges}}
                {{/categories}}
              </table>
            </div>



            <div id="box-ctf-chat" class="panel panel-default">
              <div class="panel-heading">
              <h3 style="display:inline;">Chat</h3>
              <div class="pull-right clearfix">
              <label class="checkbox-inline">
                <input id="chat-scroll" type="checkbox" checked> auto-scroll
              </label>
              </div>
              </div>
              <div class="panel-body chat-body" style="height:260px;max-height:260px;overflow-y:scroll;">
                <table style="width:100%;"><tbody id="chats"></tbody></table>
              </div>
              <div class="panel-footer">
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control form-chat-send" placeholder="Your message...">
                    <span class="input-group-btn">
                      <button type="button" class="btn btn-default btn-chat" data-chalid="{{id}}">Send</button>
                    </span>
                </div>
              </div>
            </div>


          </div>
          <div class="col-sm-9 well" id="content"></div>
        {{/current}}
        {{^current}}no CTF chosen{{/current}}
      </div>
    </div>
		  <div id="allctfsmodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>all CTFs</h3>
						</div>
						<div class="modal-body">
						  <ul>
						    {{#all_ctfs}}
						      <li><a href="/scope/{{id}}">{{name}}</a></li>
						    {{/all_ctfs}}
						  </ul>
						</div>
					</div>
				</div>
			</div>
		  <div id="ctfmodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>new CTF</h3>
						</div>
						<div class="modal-body">
						  <form id="ctfform">
						    <input type="text" placeholder="Title" class="input-xlarge" name="title">
						    <legend>Challenges</legend>
						    <div class="form-inline">
						      <span class="category-formgroup">
						        <input type="text" placeholder="Title" name="chaltitle">
						        <input type="text" class="input-small" placeholder="Category" name="chalcategory"><!--typeahead for category, add new category on input-->
						        <input type="number" class="input-mini" placeholder="Points" name="chalpoints">
						        <a href="#" class="add-challenge"><i class="glyphicon glyphicon-plus"></i></a>
						        <a href="#" class="remove-challenge"><i class="glyphicon glyphicon-remove"></i></a><br>
						      </span>
						    </div>
						  </form>
						</div>
						<div class="modal-footer">
						  <a href="#" class="btn" data-dismiss="modal">Close</a>
						  <a href="#" class="btn btn-primary" onclick="window.newctf()">Submit</a>
						</div>
					</div>
				</div>
			</div>
		  <div id="passwordmodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>Change Password</h3>
						</div>
						<div class="modal-body">
						  <div class="alert hide"></div>
						  <form id="passwordform" class="form-horizontal">
						    <div class="control-group">
						      <label class="control-label">New password:</label>
						      <div class="controls">
						        <input type="password" name="newpw" />
						      </div>
						    </div>
						    <div class="control-group">
						      <label class="control-label">Repeat password:</label>
						      <div class="controls">
						        <input type="password" name="newpw2" />
						      </div>
						    </div>
						  </form>
						</div>
						<div class="modal-footer">
						  <a href="#" class="btn" data-dismiss="modal">Close</a>
						  <a href="#" class="btn btn-primary" onclick="window.changepw()">Submit</a>
						</div>
					</div>
				</div>
			</div>
		  <div id="apikeymodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>Your API Key</h3>
						</div>
						<div class="modal-body">
						  <textarea id="apikey" type="text" class="input-xlarge" readonly>{{apikey}}</textarea><br>
						  <button class="btn btn-danger" onclick="window.newapikey()">request new key</button>
						</div>
						<div class="modal-footer">
						  <a href="#" class="btn btn-primary" data-dismiss="modal">Close</a>
						</div>
					</div>
				</div>
			</div>
    {{#current}}
		  <div id="ctfmodifymodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
				    <div class="modal-header">
				      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				      <h3>{{current.name}}</h3>
				    </div>
				    <div class="modal-body">
				      <form id="ctfmodifyform" autocomplete="off">
				        <legend>Challenges</legend>
				        <div class="form-inline">
				          {{^categories}}
				          <span class="category-formgroup dummy">
				            <input type="hidden" name="chalid" value="{{id}}">
				            <input type="text" placeholder="title" name="chaltitle" value="{{title}}" class="hide" autocomplete="off">
				            <input type="text" class="input-small hide" placeholder="category" name="chalcategory" value="{{category}}" autocomplete="off">
				            <input type="number" class="input-mini hide" placeholder="points" name="chalpoints" value="{{points}}" autocomplete="off">
				            <a href="#" class="add-challenge"><i class="glyphicon glyphicon-plus"></i></a>
				          </span><br>
				          {{/categories}}
				          {{#categories}}{{#challenges}}
				          <span class="category-formgroup">
				            <input type="hidden" name="chalid" value="{{id}}">
				            <input type="text" placeholder="title" name="chaltitle" value="{{title}}" autocomplete="off">
				            <input type="text" class="input-small" placeholder="category" name="chalcategory" value="{{category}}" data-provide="typeahead" data-items="4" data-source='[{{#categories}}"{{name}}",{{/categories}}""]' data-placement="above" autocomplete="off">
				            <input type="number" class="input-mini" placeholder="points" name="chalpoints" value="{{points}}" autocomplete="off">
				            <a href="#" class="add-challenge"><i class="glyphicon glyphicon-plus"></i></a>
				          </span><br>
				          {{/challenges}}{{/categories}}
				        </div>
				      </form>
				      <br><br><br><br>
				    </div>
				    <div class="modal-footer">
				      <a href="#" class="btn" data-dismiss="modal">Close</a>
				      <a href="#" class="btn btn-primary" onclick="window.modifyctf()">Submit</a>
				    </div>
			 	 	</div>
				</div>
			</div>
		{{/current}}
    <div id="usermodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>Users online</h3>
						</div>
						<div class="modal-body">
						  <ul class="unstyled" id="userlist">
						  </ul>
						</div>
					</div>
				</div>
			</div>
		  <div id="deletefilemodal" class="modal fade">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
						  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						  <h3>Delete file</h3>
						</div>
						<div class="modal-body">
						  <div class="alert hide"></div>
						  <p>Are you sure, that you want to delete the file "<span id="deletefilename"></span>"?</p>
						</div>
						<div class="modal-footer">
						  <button type="button" class="btn" data-dismiss="modal" id="deletefilebtnno">No</button>
						  <button type="button" class="btn btn-primary" id="deletefilebtnyes" onclick="window.delete_file_confirmed()">Yes</a>
						</div>
					</div>
				</div>
			</div>
		</div>
  </body>
</html>
